"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[583],{6110:function(e,t,o){o.d(t,{$N:function(){return f},Be:function(){return w},Vq:function(){return i},cZ:function(){return g},fK:function(){return h},hg:function(){return c}});var r=o(7437),a=o(2265),n=o(9027),s=o(2489),l=o(4508);let i=n.fC,c=n.xz,d=n.h_;n.x8;let u=a.forwardRef((e,t)=>{let{className:o,...a}=e;return(0,r.jsx)(n.aV,{ref:t,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",o),...a})});u.displayName=n.aV.displayName;let g=a.forwardRef((e,t)=>{let{className:o,children:a,...i}=e;return(0,r.jsxs)(d,{children:[(0,r.jsx)(u,{}),(0,r.jsxs)(n.VY,{ref:t,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",o),...i,children:[a,(0,r.jsxs)(n.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(s.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});g.displayName=n.VY.displayName;let h=e=>{let{className:t,...o}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...o})};h.displayName="DialogHeader";let f=a.forwardRef((e,t)=>{let{className:o,...a}=e;return(0,r.jsx)(n.Dx,{ref:t,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",o),...a})});f.displayName=n.Dx.displayName;let w=a.forwardRef((e,t)=>{let{className:o,...a}=e;return(0,r.jsx)(n.dk,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",o),...a})});w.displayName=n.dk.displayName},2061:function(e,t,o){o.d(t,{WalletProvider:function(){return u},O:function(){return g}});var r=o(7437),a=o(2265);class n{get provider(){return window.unisat}async connect(){if(!this.provider)throw Error("UNISAT Wallet is not installed. Please install it from https://unisat.io");try{let e=await this.provider.requestAccounts();if(!e||0===e.length)throw Error("No accounts found in UNISAT Wallet");return e}catch(e){if(e.message.includes("User rejected"))throw Error("User rejected the connection request");throw e}}async disconnect(){}async signMessage(e){if(!this.provider)throw Error("UNISAT Wallet is not connected");try{return await this.provider.signMessage(e)}catch(e){if(e.message.includes("User rejected"))throw Error("User rejected the signature request");throw e}}async getPublicKey(){if(!this.provider)throw Error("UNISAT Wallet is not connected");try{return await this.provider.getPublicKey()}catch(e){return console.warn("Failed to get public key:",e),""}}async signPsbt(e){if(!this.provider)throw Error("UNISAT Wallet is not connected");try{return await this.provider.signPsbt(e)}catch(e){if(e.message.includes("User rejected"))throw Error("User rejected the PSBT signature request");throw e}}constructor(){this.name="UNISAT",this.icon="bg-orange-500"}}class s{get provider(){var e,t;let o=window;return(null===(e=o.okxwallet)||void 0===e?void 0:e.fractalBitcoin)||(null===(t=o.okxwallet)||void 0===t?void 0:t.bitcoin)}async connect(){let e=window;if(!e.okxwallet)throw Error("OKX Wallet is not installed. Please install it from https://www.okx.com/web3");try{var t;let o;if((null===(t=this.provider)||void 0===t?void 0:t.disconnect)&&await this.provider.disconnect(),e.okxwallet.fractalBitcoin)o=await e.okxwallet.fractalBitcoin.requestAccounts();else if(e.okxwallet.bitcoin)o=await e.okxwallet.bitcoin.requestAccounts();else throw Error("OKX Wallet Bitcoin support not found");if(!o||0===o.length)throw Error("No accounts found in OKX Wallet");return o}catch(e){if(e.message.includes("User rejected"))throw Error("User rejected the connection request");throw e}}async disconnect(){var e;(null===(e=this.provider)||void 0===e?void 0:e.disconnect)&&await this.provider.disconnect()}async signMessage(e){if(!this.provider)throw Error("OKX Wallet is not connected");try{return await this.provider.signMessage(e,"bip322-simple")}catch(e){if(e.message.includes("User rejected"))throw Error("User rejected the signature request");throw e}}async getPublicKey(){if(!this.provider)throw Error("OKX Wallet is not connected");try{return await this.provider.getPublicKey()}catch(e){return console.warn("Failed to get public key:",e),""}}constructor(){this.name="OKX Web3",this.icon="bg-purple-500"}}let l="https://api-inner-test.bitwood.fun/api/v1";class i{static getAuthHeaders(e){let t={"Content-Type":"application/json"};return e&&(t.Authorization="Bearer ".concat(e)),t}static async handleResponse(e){if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return await e.json()}static async getMessage(){try{let e=await fetch("".concat(l,"/message"),{method:"GET",headers:this.getAuthHeaders()});return(await this.handleResponse(e)).data.message}catch(e){throw console.error("Failed to get message:",e),Error("Failed to get signing message")}}static async login(e){try{let t=await fetch("".concat(l,"/login"),{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)});return await this.handleResponse(t)}catch(e){throw console.error("Login failed:",e),Error("Login failed")}}static async getProfile(e){try{let t=await fetch("".concat(l,"/profile"),{method:"GET",headers:this.getAuthHeaders(e)});return await this.handleResponse(t)}catch(e){throw console.error("Failed to get profile:",e),Error("Failed to get user profile")}}}let c=(0,a.createContext)(null),d={UNISAT:new n,OKX:new s};function u(e){let{children:t}=e;console.log("[WalletContext] WalletProvider initializing...");let[o,n]=(0,a.useState)(null),[s,l]=(0,a.useState)(!1),[u,g]=(0,a.useState)(!1),[h,f]=(0,a.useState)(null),[w,m]=(0,a.useState)(null),[p,y]=(0,a.useState)(()=>{let e=localStorage.getItem("authToken"),t="true"===localStorage.getItem("isLoggedIn"),o=t&&!!e;return console.log("[WalletContext] Initial isLoggedIn state:",{savedToken:e?e.substring(0,20)+"...":null,savedLoginState:t,initialValue:o}),o}),[v,x]=(0,a.useState)(null),[b,S]=(0,a.useState)(null),[N,k]=(0,a.useState)(!1),[E,I]=(0,a.useState)(!0),W=async e=>{try{l(!0);let t=d[e],o=await t.connect();o&&o.length>0&&(n(o[0]),g(!0),f(e),m(t),localStorage.setItem("walletConnected","true"),localStorage.setItem("walletAddress",o[0]),localStorage.setItem("walletType",e),await T(t,o[0]))}catch(e){throw console.error("Connection error:",e),alert(e.message||"Failed to connect wallet"),e}finally{l(!1)}},T=async(e,t)=>{try{k(!0);let o=await i.getMessage(),r="";try{e.getPublicKey&&(r=await e.getPublicKey())}catch(e){console.warn("Failed to get public key:",e)}let a=await e.signMessage(o),n=await i.login({sign:a,walletAddress:t,publicKey:r});if(0===n.errcode&&n.data){let{token:e,player:o}=n.data;if(!e)throw Error("Login response missing token");S(e),x(o||null),y(!0),localStorage.setItem("authToken",e),o&&localStorage.setItem("userData",JSON.stringify(o)),localStorage.setItem("isLoggedIn","true"),console.log("Login successful for:",t);let r=document.createElement("div");r.textContent="\uD83C\uDF89 Login successful!",r.className="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50 rpg-card !p-3 !bg-primary !text-primary-foreground font-bold",document.body.appendChild(r),setTimeout(()=>{r.parentNode&&document.body.removeChild(r)},3e3)}else throw Error("Login failed with error code: "+n.data.errcode)}catch(e){console.error("Login error:",e),alert("Login failed: "+(e.message||"Unknown error"))}finally{k(!1)}},C=async()=>{if(!w||!o)throw Error("Wallet not connected");await T(w,o)},j=()=>{y(!1),x(null),S(null),localStorage.removeItem("authToken"),localStorage.removeItem("userData"),localStorage.removeItem("isLoggedIn")},A=async e=>{if(!w||!u)throw Error("Wallet not connected");try{return await w.signMessage(e)}catch(e){throw console.error("Signing error:",e),e}};return(0,a.useEffect)(()=>{console.log("[WalletContext] useEffect starting...");let e="true"===localStorage.getItem("walletConnected"),t=localStorage.getItem("walletAddress"),o=localStorage.getItem("walletType");console.log("[WalletContext] Restoring wallet connection:",{isConnected:e,savedAddress:t?t.substring(0,10)+"...":null,savedType:o}),e&&t&&o&&(n(t),g(!0),f(o),m(d[o]));let r=localStorage.getItem("authToken"),a=localStorage.getItem("userData");if(console.log("[WalletContext] Restoring auth state:",{savedToken:r?r.substring(0,20)+"...":null,savedUserData:a?"exists":null}),r){if(S(r),y(!0),a&&"undefined"!==a&&"null"!==a)try{let e=JSON.parse(a);x(e),console.log("[WalletContext] ✅ Restored login session for:",e.wallet_address||"unknown")}catch(e){console.error("[WalletContext] ⚠️ Failed to parse user data, but token is valid:",e)}else console.log("[WalletContext] ✅ Restored login session with token (no user data)")}else console.log("[WalletContext] No saved token found, user not logged in");console.log("[WalletContext] Setting initializing to false"),I(!1)},[]),(0,r.jsx)(c.Provider,{value:{address:o,connecting:s,connected:u,walletType:h,isLoggedIn:p,user:v,token:b,logging:N,initializing:E,connect:W,disconnect:()=>{(null==w?void 0:w.disconnect)&&w.disconnect().catch(console.error),n(null),g(!1),f(null),m(null),localStorage.removeItem("walletConnected"),localStorage.removeItem("walletAddress"),localStorage.removeItem("walletType"),j()},signMessage:A,login:C,logout:j},children:t})}function g(){let e=(0,a.useContext)(c);if(!e)throw Error("useWallet must be used within WalletProvider");return e}},4508:function(e,t,o){o.d(t,{S:function(){return s},cn:function(){return n}});var r=o(1994),a=o(3335);function n(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,a.m6)((0,r.W)(t))}function s(e){let t=new Date,o=new Date(e),r=Math.floor((t.getTime()-o.getTime())/1e3);if(r<60)return"".concat(r," second").concat(1!==r?"s":""," ago");let a=Math.floor(r/60);if(a<60)return"".concat(a," minute").concat(1!==a?"s":""," ago");let n=Math.floor(a/60);if(n<24)return"".concat(n," hour").concat(1!==n?"s":""," ago");let s=Math.floor(n/24);if(s<30)return"".concat(s," day").concat(1!==s?"s":""," ago");let l=Math.floor(s/30);if(l<12)return"".concat(l," month").concat(1!==l?"s":""," ago");let i=Math.floor(l/12);return"".concat(i," year").concat(1!==i?"s":""," ago")}}}]);