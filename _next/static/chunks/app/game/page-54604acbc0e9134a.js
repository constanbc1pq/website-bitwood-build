(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[421],{9987:function(e,t,a){Promise.resolve().then(a.bind(a,1804))},1804:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return r}});var n=a(7437),o=a(2265),s=a(7105),l=a(6110);function r(){let e=(0,o.useRef)(null),{isLoggedIn:t,token:a,connecting:r,initializing:i,connect:c,logout:d}=(0,s.O)(),[u,g]=(0,o.useState)("");console.log("[GamePage] Render - State:",{isLoggedIn:t,hasToken:!!a,connecting:r,initializing:i}),(0,o.useEffect)(()=>{let e=()=>{let e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),t=window.innerWidth<768,a=e||t;console.log("[GamePage] Device Detection:",{isMobile:e,isSmallScreen:t,isMobileDevice:a,userAgent:navigator.userAgent,screenWidth:window.innerWidth});let n="https://game-build-test.bitwood.fun/",o="https://game-build-test-mobile.bitwood.fun/",s=a&&o?o:n;console.log("[GamePage] Selected Game URL:",{isMobileDevice:a,selectedUrl:s,desktopGameUrl:n,mobileGameUrl:o}),g(s)};e();let t=()=>{e()};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);let m=async e=>{try{await c(e)}catch(e){console.error("Failed to connect:",e)}};return((0,o.useEffect)(()=>{if(!t||!a||!u)return;let n=()=>{e.current&&e.current.contentWindow&&(console.log("[GamePage] Sending token to iframe via postMessage"),e.current.contentWindow.postMessage({type:"TOKEN_TRANSFER",token:a},u))},o=e=>{let t=new URL(u);if(e.origin===t.origin)switch(e.data.type){case"GAME_READY":case"TOKEN_REQUEST":console.log("[GamePage] Game requesting token, sending..."),n();break;case"GAME_LOGOUT":console.log("[GamePage] \uD83D\uDEAA Received logout request from game"),s()}},s=()=>{console.log("[GamePage] \uD83D\uDEAA Received logout request from game"),console.log("[GamePage] \uD83E\uDDF9 Clearing parent page auth data..."),localStorage.removeItem("walletConnected"),localStorage.removeItem("walletAddress"),localStorage.removeItem("walletType"),d(),console.log("[GamePage] ✅ Parent page logged out, showing wallet selection")};window.addEventListener("message",o);let l=e.current;return l&&(l.onload=()=>{setTimeout(n,500)}),()=>{window.removeEventListener("message",o)}},[t,a,u,d]),i)?(console.log("[GamePage] Showing loading screen (initializing=true)"),(0,n.jsx)("div",{className:"w-full h-screen flex items-center justify-center bg-black",children:(0,n.jsx)("div",{className:"text-white text-xl font-bold",children:"Loading..."})})):t?(console.log("[GamePage] ✅ User is logged in, showing game iframe with URL:",u),u)?(0,n.jsx)("div",{className:"w-full h-screen overflow-hidden bg-black",children:(0,n.jsx)("iframe",{ref:e,src:u,className:"w-full h-full border-none",allow:"fullscreen",allowFullScreen:!0,title:"BitWood Game"})}):(0,n.jsx)("div",{className:"w-full h-screen flex items-center justify-center bg-black",children:(0,n.jsx)("div",{className:"text-white text-xl font-bold",children:"Loading Game..."})}):(console.log("[GamePage] Showing wallet selection (isLoggedIn=false)"),console.log("[GamePage] localStorage check:",{authToken:localStorage.getItem("authToken")?"exists":"missing",isLoggedIn:localStorage.getItem("isLoggedIn"),userData:localStorage.getItem("userData")?"exists":"missing"}),(0,n.jsx)("div",{className:"w-full h-screen flex items-center justify-center bg-[url('/wood-bg.jpg')] bg-cover bg-center",children:(0,n.jsx)(l.Vq,{open:!0,children:(0,n.jsxs)(l.cZ,{className:"rpg-card !max-w-md !p-8 !border-4 !border-black !rounded-lg",children:[(0,n.jsx)(l.fK,{className:"mb-6",children:(0,n.jsx)(l.$N,{className:"text-2xl font-bold text-primary text-center tracking-widest uppercase",children:"=== SELECT WALLET ==="})}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("button",{onClick:()=>m("UNISAT"),className:"rpg-menu-item w-full flex items-center justify-between !p-4",disabled:r,children:[(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("div",{className:"w-8 h-8 bg-orange-500 rounded border-2 border-black"}),(0,n.jsx)("span",{className:"text-xl font-bold",children:"UNISAT WALLET"})]}),(0,n.jsx)("span",{className:"text-2xl",children:">"})]}),(0,n.jsxs)("button",{onClick:()=>m("OKX"),className:"rpg-menu-item w-full flex items-center justify-between !p-4",disabled:r,children:[(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("div",{className:"w-8 h-8 bg-purple-500 rounded border-2 border-black"}),(0,n.jsx)("span",{className:"text-xl font-bold",children:"OKX WEB3"})]}),(0,n.jsx)("span",{className:"text-2xl",children:">"})]})]}),(0,n.jsxs)("div",{className:"mt-6 text-center text-sm text-muted-foreground",children:[(0,n.jsx)("p",{className:"font-mono",children:"> Connect wallet to enter the game"}),(0,n.jsx)("p",{className:"font-mono",children:"> Fractal Bitcoin compatible"})]})]})})}))}},6110:function(e,t,a){"use strict";a.d(t,{$N:function(){return f},Be:function(){return x},Vq:function(){return i},cZ:function(){return g},fK:function(){return m},hg:function(){return c}});var n=a(7437),o=a(2265),s=a(9027),l=a(2489),r=a(4508);let i=s.fC,c=s.xz,d=s.h_;s.x8;let u=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(s.aV,{ref:t,className:(0,r.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...o})});u.displayName=s.aV.displayName;let g=o.forwardRef((e,t)=>{let{className:a,children:o,...i}=e;return(0,n.jsxs)(d,{children:[(0,n.jsx)(u,{}),(0,n.jsxs)(s.VY,{ref:t,className:(0,r.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...i,children:[o,(0,n.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,n.jsx)(l.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});g.displayName=s.VY.displayName;let m=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,r.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};m.displayName="DialogHeader";let f=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(s.Dx,{ref:t,className:(0,r.cn)("text-lg font-semibold leading-none tracking-tight",a),...o})});f.displayName=s.Dx.displayName;let x=o.forwardRef((e,t)=>{let{className:a,...o}=e;return(0,n.jsx)(s.dk,{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",a),...o})});x.displayName=s.dk.displayName},4508:function(e,t,a){"use strict";a.d(t,{S:function(){return l},cn:function(){return s}});var n=a(1994),o=a(3335);function s(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,o.m6)((0,n.W)(t))}function l(e){let t=new Date,a=new Date(e),n=Math.floor((t.getTime()-a.getTime())/1e3);if(n<60)return"".concat(n," second").concat(1!==n?"s":""," ago");let o=Math.floor(n/60);if(o<60)return"".concat(o," minute").concat(1!==o?"s":""," ago");let s=Math.floor(o/60);if(s<24)return"".concat(s," hour").concat(1!==s?"s":""," ago");let l=Math.floor(s/24);if(l<30)return"".concat(l," day").concat(1!==l?"s":""," ago");let r=Math.floor(l/30);if(r<12)return"".concat(r," month").concat(1!==r?"s":""," ago");let i=Math.floor(r/12);return"".concat(i," year").concat(1!==i?"s":""," ago")}}},function(e){e.O(0,[498,105,971,117,744],function(){return e(e.s=9987)}),_N_E=e.O()}]);