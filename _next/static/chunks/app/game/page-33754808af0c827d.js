(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[421],{9987:function(e,t,l){Promise.resolve().then(l.bind(l,1804))},1804:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return r}});var s=l(7437),a=l(2265),n=l(2061),o=l(6110);function r(){let e=(0,a.useRef)(null),{isLoggedIn:t,token:l,connecting:r,initializing:c,connect:i,logout:d}=(0,n.O)();console.log("[GamePage] Render - State:",{isLoggedIn:t,hasToken:!!l,connecting:r,initializing:c});let g=async e=>{try{await i(e)}catch(e){console.error("Failed to connect:",e)}};return((0,a.useEffect)(()=>{if(!t||!l)return;let s=()=>{e.current&&e.current.contentWindow&&(console.log("[GamePage] Sending token to iframe via postMessage"),e.current.contentWindow.postMessage({type:"TOKEN_TRANSFER",token:l},"http://localhost:7456"))},a=e=>{let t=new URL("http://localhost:7456");if(e.origin===t.origin)switch(e.data.type){case"GAME_READY":case"TOKEN_REQUEST":console.log("[GamePage] Game requesting token, sending..."),s();break;case"GAME_LOGOUT":console.log("[GamePage] \uD83D\uDEAA Received logout request from game"),n()}},n=()=>{console.log("[GamePage] \uD83D\uDEAA Received logout request from game"),console.log("[GamePage] \uD83E\uDDF9 Clearing parent page auth data..."),localStorage.removeItem("walletConnected"),localStorage.removeItem("walletAddress"),localStorage.removeItem("walletType"),d(),console.log("[GamePage] ✅ Parent page logged out, showing wallet selection")};window.addEventListener("message",a);let o=e.current;return o&&(o.onload=()=>{setTimeout(s,500)}),()=>{window.removeEventListener("message",a)}},[t,l,d]),c)?(console.log("[GamePage] Showing loading screen (initializing=true)"),(0,s.jsx)("div",{className:"w-full h-screen flex items-center justify-center bg-black",children:(0,s.jsx)("div",{className:"text-white text-xl font-bold",children:"Loading..."})})):t?(console.log("[GamePage] ✅ User is logged in, showing game iframe"),(0,s.jsx)("div",{className:"w-full h-screen overflow-hidden bg-black",children:(0,s.jsx)("iframe",{ref:e,src:"http://localhost:7456",className:"w-full h-full border-none",allow:"fullscreen",allowFullScreen:!0,title:"BitWood Game"})})):(console.log("[GamePage] Showing wallet selection (isLoggedIn=false)"),console.log("[GamePage] localStorage check:",{authToken:localStorage.getItem("authToken")?"exists":"missing",isLoggedIn:localStorage.getItem("isLoggedIn"),userData:localStorage.getItem("userData")?"exists":"missing"}),(0,s.jsx)("div",{className:"w-full h-screen flex items-center justify-center bg-[url('/wood-bg.jpg')] bg-cover bg-center",children:(0,s.jsx)(o.Vq,{open:!0,children:(0,s.jsxs)(o.cZ,{className:"rpg-card !max-w-md !p-8 !border-4 !border-black !rounded-lg",children:[(0,s.jsx)(o.fK,{className:"mb-6",children:(0,s.jsx)(o.$N,{className:"text-2xl font-bold text-primary text-center tracking-widest uppercase",children:"=== SELECT WALLET ==="})}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("button",{onClick:()=>g("UNISAT"),className:"rpg-menu-item w-full flex items-center justify-between !p-4",disabled:r,children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-orange-500 rounded border-2 border-black"}),(0,s.jsx)("span",{className:"text-xl font-bold",children:"UNISAT WALLET"})]}),(0,s.jsx)("span",{className:"text-2xl",children:">"})]}),(0,s.jsxs)("button",{onClick:()=>g("OKX"),className:"rpg-menu-item w-full flex items-center justify-between !p-4",disabled:r,children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-purple-500 rounded border-2 border-black"}),(0,s.jsx)("span",{className:"text-xl font-bold",children:"OKX WEB3"})]}),(0,s.jsx)("span",{className:"text-2xl",children:">"})]})]}),(0,s.jsxs)("div",{className:"mt-6 text-center text-sm text-muted-foreground",children:[(0,s.jsx)("p",{className:"font-mono",children:"> Connect wallet to enter the game"}),(0,s.jsx)("p",{className:"font-mono",children:"> Fractal Bitcoin compatible"})]})]})})}))}}},function(e){e.O(0,[498,583,971,117,744],function(){return e(e.s=9987)}),_N_E=e.O()}]);