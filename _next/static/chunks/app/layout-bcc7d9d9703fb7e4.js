(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{55:function(e,t,r){Promise.resolve().then(r.bind(r,2061)),Promise.resolve().then(r.bind(r,9197)),Promise.resolve().then(r.t.bind(r,5485,23)),Promise.resolve().then(r.t.bind(r,4028,23)),Promise.resolve().then(r.t.bind(r,7960,23))},2061:function(e,t,r){"use strict";r.d(t,{WalletProvider:function(){return d},O:function(){return f}});var o=r(7437),n=r(2265);class a{get provider(){return window.unisat}async connect(){if(!this.provider)throw Error("UNISAT Wallet is not installed. Please install it from https://unisat.io");try{let e=await this.provider.requestAccounts();if(!e||0===e.length)throw Error("No accounts found in UNISAT Wallet");return e}catch(e){if(e.message.includes("User rejected"))throw Error("User rejected the connection request");throw e}}async disconnect(){}async signMessage(e){if(!this.provider)throw Error("UNISAT Wallet is not connected");try{return await this.provider.signMessage(e)}catch(e){if(e.message.includes("User rejected"))throw Error("User rejected the signature request");throw e}}async getPublicKey(){if(!this.provider)throw Error("UNISAT Wallet is not connected");try{return await this.provider.getPublicKey()}catch(e){return console.warn("Failed to get public key:",e),""}}async signPsbt(e){if(!this.provider)throw Error("UNISAT Wallet is not connected");try{return await this.provider.signPsbt(e)}catch(e){if(e.message.includes("User rejected"))throw Error("User rejected the PSBT signature request");throw e}}constructor(){this.name="UNISAT",this.icon="bg-orange-500"}}class s{get provider(){var e,t;let r=window;return(null===(e=r.okxwallet)||void 0===e?void 0:e.fractalBitcoin)||(null===(t=r.okxwallet)||void 0===t?void 0:t.bitcoin)}async connect(){let e=window;if(!e.okxwallet)throw Error("OKX Wallet is not installed. Please install it from https://www.okx.com/web3");try{var t;let r;if((null===(t=this.provider)||void 0===t?void 0:t.disconnect)&&await this.provider.disconnect(),e.okxwallet.fractalBitcoin)r=await e.okxwallet.fractalBitcoin.requestAccounts();else if(e.okxwallet.bitcoin)r=await e.okxwallet.bitcoin.requestAccounts();else throw Error("OKX Wallet Bitcoin support not found");if(!r||0===r.length)throw Error("No accounts found in OKX Wallet");return r}catch(e){if(e.message.includes("User rejected"))throw Error("User rejected the connection request");throw e}}async disconnect(){var e;(null===(e=this.provider)||void 0===e?void 0:e.disconnect)&&await this.provider.disconnect()}async signMessage(e){if(!this.provider)throw Error("OKX Wallet is not connected");try{return await this.provider.signMessage(e,"bip322-simple")}catch(e){if(e.message.includes("User rejected"))throw Error("User rejected the signature request");throw e}}async getPublicKey(){if(!this.provider)throw Error("OKX Wallet is not connected");try{return await this.provider.getPublicKey()}catch(e){return console.warn("Failed to get public key:",e),""}}constructor(){this.name="OKX Web3",this.icon="bg-purple-500"}}let i="http://localhost:5762/api/v1";class l{static getAuthHeaders(e){let t={"Content-Type":"application/json"};return e&&(t.Authorization="Bearer ".concat(e)),t}static async handleResponse(e){if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return await e.json()}static async getMessage(){try{let e=await fetch("".concat(i,"/message"),{method:"GET",headers:this.getAuthHeaders()});return(await this.handleResponse(e)).data.message}catch(e){throw console.error("Failed to get message:",e),Error("Failed to get signing message")}}static async login(e){try{let t=await fetch("".concat(i,"/login"),{method:"POST",headers:this.getAuthHeaders(),body:JSON.stringify(e)});return await this.handleResponse(t)}catch(e){throw console.error("Login failed:",e),Error("Login failed")}}static async getProfile(e){try{let t=await fetch("".concat(i,"/profile"),{method:"GET",headers:this.getAuthHeaders(e)});return await this.handleResponse(t)}catch(e){throw console.error("Failed to get profile:",e),Error("Failed to get user profile")}}}let c=(0,n.createContext)(null),u={UNISAT:new a,OKX:new s};function d(e){let{children:t}=e;console.log("[WalletContext] WalletProvider initializing...");let[r,a]=(0,n.useState)(null),[s,i]=(0,n.useState)(!1),[d,f]=(0,n.useState)(!1),[h,g]=(0,n.useState)(null),[w,m]=(0,n.useState)(null),[p,v]=(0,n.useState)(()=>{let e=localStorage.getItem("authToken"),t="true"===localStorage.getItem("isLoggedIn"),r=t&&!!e;return console.log("[WalletContext] Initial isLoggedIn state:",{savedToken:e?e.substring(0,20)+"...":null,savedLoginState:t,initialValue:r}),r}),[y,b]=(0,n.useState)(null),[S,E]=(0,n.useState)(null),[T,P]=(0,n.useState)(!1),[k,A]=(0,n.useState)(!0),x=async e=>{try{i(!0);let t=u[e],r=await t.connect();r&&r.length>0&&(a(r[0]),f(!0),g(e),m(t),localStorage.setItem("walletConnected","true"),localStorage.setItem("walletAddress",r[0]),localStorage.setItem("walletType",e),await _(t,r[0]))}catch(e){throw console.error("Connection error:",e),alert(e.message||"Failed to connect wallet"),e}finally{i(!1)}},_=async(e,t)=>{try{P(!0);let r=await l.getMessage(),o="";try{e.getPublicKey&&(o=await e.getPublicKey())}catch(e){console.warn("Failed to get public key:",e)}let n=await e.signMessage(r),a=await l.login({sign:n,walletAddress:t,publicKey:o});if(0===a.errcode&&a.data){let{token:e,player:r}=a.data;if(!e)throw Error("Login response missing token");E(e),b(r||null),v(!0),localStorage.setItem("authToken",e),r&&localStorage.setItem("userData",JSON.stringify(r)),localStorage.setItem("isLoggedIn","true"),console.log("Login successful for:",t);let o=document.createElement("div");o.textContent="\uD83C\uDF89 Login successful!",o.className="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50 rpg-card !p-3 !bg-primary !text-primary-foreground font-bold",document.body.appendChild(o),setTimeout(()=>{o.parentNode&&document.body.removeChild(o)},3e3)}else throw Error("Login failed with error code: "+a.data.errcode)}catch(e){console.error("Login error:",e),alert("Login failed: "+(e.message||"Unknown error"))}finally{P(!1)}},I=async()=>{if(!w||!r)throw Error("Wallet not connected");await _(w,r)},C=()=>{v(!1),b(null),E(null),localStorage.removeItem("authToken"),localStorage.removeItem("userData"),localStorage.removeItem("isLoggedIn")},W=async e=>{if(!w||!d)throw Error("Wallet not connected");try{return await w.signMessage(e)}catch(e){throw console.error("Signing error:",e),e}};return(0,n.useEffect)(()=>{console.log("[WalletContext] useEffect starting...");let e="true"===localStorage.getItem("walletConnected"),t=localStorage.getItem("walletAddress"),r=localStorage.getItem("walletType");console.log("[WalletContext] Restoring wallet connection:",{isConnected:e,savedAddress:t?t.substring(0,10)+"...":null,savedType:r}),e&&t&&r&&(a(t),f(!0),g(r),m(u[r]));let o=localStorage.getItem("authToken"),n=localStorage.getItem("userData");if(console.log("[WalletContext] Restoring auth state:",{savedToken:o?o.substring(0,20)+"...":null,savedUserData:n?"exists":null}),o){if(E(o),v(!0),n&&"undefined"!==n&&"null"!==n)try{let e=JSON.parse(n);b(e),console.log("[WalletContext] ✅ Restored login session for:",e.wallet_address||"unknown")}catch(e){console.error("[WalletContext] ⚠️ Failed to parse user data, but token is valid:",e)}else console.log("[WalletContext] ✅ Restored login session with token (no user data)")}else console.log("[WalletContext] No saved token found, user not logged in");console.log("[WalletContext] Setting initializing to false"),A(!1)},[]),(0,o.jsx)(c.Provider,{value:{address:r,connecting:s,connected:d,walletType:h,isLoggedIn:p,user:y,token:S,logging:T,initializing:k,connect:x,disconnect:()=>{(null==w?void 0:w.disconnect)&&w.disconnect().catch(console.error),a(null),f(!1),g(null),m(null),localStorage.removeItem("walletConnected"),localStorage.removeItem("walletAddress"),localStorage.removeItem("walletType"),C()},signMessage:W,login:I,logout:C},children:t})}function f(){let e=(0,n.useContext)(c);if(!e)throw Error("useWallet must be used within WalletProvider");return e}},9376:function(e,t,r){"use strict";var o=r(5475);r.o(o,"useParams")&&r.d(t,{useParams:function(){return o.useParams}}),r.o(o,"usePathname")&&r.d(t,{usePathname:function(){return o.usePathname}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}}),r.o(o,"useSearchParams")&&r.d(t,{useSearchParams:function(){return o.useSearchParams}})},257:function(e,t,r){"use strict";var o,n;e.exports=(null==(o=r.g.process)?void 0:o.env)&&"object"==typeof(null==(n=r.g.process)?void 0:n.env)?r.g.process:r(4227)},4227:function(e){!function(){var t={229:function(e){var t,r,o,n=e.exports={};function a(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var l=[],c=!1,u=-1;function d(){c&&o&&(c=!1,o.length?l=o.concat(l):u=-1,l.length&&f())}function f(){if(!c){var e=i(d);c=!0;for(var t=l.length;t;){for(o=l,l=[];++u<t;)o&&o[u].run();u=-1,t=l.length}o=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function g(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new h(e,t)),1!==l.length||c||i(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=g,n.addListener=g,n.once=g,n.off=g,n.removeListener=g,n.removeAllListeners=g,n.emit=g,n.prependListener=g,n.prependOnceListener=g,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},r={};function o(e){var n=r[e];if(void 0!==n)return n.exports;var a=r[e]={exports:{}},s=!0;try{t[e](a,a.exports,o),s=!1}finally{s&&delete r[e]}return a.exports}o.ab="//";var n=o(229);e.exports=n}()},7960:function(){},4028:function(e){e.exports={style:{fontFamily:"'__GeistMono_f910ec', ui-monospace, SFMono-Regular, Roboto Mono, Menlo, Monaco, Liberation Mono, DejaVu Sans Mono, Courier New, monospace"},className:"__className_f910ec",variable:"__variable_f910ec"}},5485:function(e){e.exports={style:{fontFamily:"'__GeistSans_fb8f2c', '__GeistSans_Fallback_fb8f2c'"},className:"__className_fb8f2c",variable:"__variable_fb8f2c"}},9197:function(e,t,r){"use strict";r.d(t,{Analytics:function(){return g}});var o=r(2265),n=r(9376),a=r(257),s=()=>{window.va||(window.va=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];(window.vaq=window.vaq||[]).push(t)})};function i(){return"undefined"!=typeof window}function l(){return"production"}function c(){return"development"===((i()?window.vam:l())||"production")}function u(e){return new RegExp("/".concat(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"(?=[/?#]|$)"))}function d(e){return(0,o.useEffect)(()=>{var t;e.beforeSend&&(null==(t=window.va)||t.call(window,"beforeSend",e.beforeSend))},[e.beforeSend]),(0,o.useEffect)(()=>{var t;!function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{debug:!0};if(!i())return;(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto";if("auto"===e){window.vam=l();return}window.vam=e})(t.mode),s(),t.beforeSend&&(null==(e=window.va)||e.call(window,"beforeSend",t.beforeSend));let r=t.scriptSrc?t.scriptSrc:c()?"https://va.vercel-scripts.com/v1/script.debug.js":t.basePath?"".concat(t.basePath,"/insights/script.js"):"/_vercel/insights/script.js";if(document.head.querySelector('script[src*="'.concat(r,'"]')))return;let o=document.createElement("script");o.src=r,o.defer=!0,o.dataset.sdkn="@vercel/analytics"+(t.framework?"/".concat(t.framework):""),o.dataset.sdkv="1.5.0",t.disableAutoTrack&&(o.dataset.disableAutoTrack="1"),t.endpoint?o.dataset.endpoint=t.endpoint:t.basePath&&(o.dataset.endpoint="".concat(t.basePath,"/insights")),t.dsn&&(o.dataset.dsn=t.dsn),o.onerror=()=>{let e=c()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log("[Vercel Web Analytics] Failed to load script from ".concat(r,". ").concat(e))},c()&&!1===t.debug&&(o.dataset.debug="false"),document.head.appendChild(o)}({framework:e.framework||"react",basePath:null!==(t=e.basePath)&&void 0!==t?t:function(){if(void 0!==a&&void 0!==a.env)return a.env.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}(),...void 0!==e.route&&{disableAutoTrack:!0},...e})},[]),(0,o.useEffect)(()=>{e.route&&e.path&&function(e){var t;let{route:r,path:o}=e;null==(t=window.va)||t.call(window,"pageview",{route:r,path:o})}({route:e.route,path:e.path})},[e.route,e.path]),null}var f=()=>{let e=(0,n.useParams)(),t=(0,n.useSearchParams)(),r=(0,n.usePathname)();return e?{route:function(e,t){if(!e||!t)return e;let r=e;try{let e=Object.entries(t);for(let[t,o]of e)if(!Array.isArray(o)){let e=u(o);e.test(r)&&(r=r.replace(e,"/[".concat(t,"]")))}for(let[t,o]of e)if(Array.isArray(o)){let e=u(o.join("/"));e.test(r)&&(r=r.replace(e,"/[...".concat(t,"]")))}return r}catch(t){return e}}(r,Object.keys(e).length?e:Object.fromEntries(t.entries())),path:r}:{route:null,path:r}};function h(e){let{route:t,path:r}=f();return o.createElement(d,{path:r,route:t,...e,basePath:function(){if(void 0!==a&&void 0!==a.env)return a.env.NEXT_PUBLIC_VERCEL_OBSERVABILITY_BASEPATH}(),framework:"next"})}function g(e){return o.createElement(o.Suspense,{fallback:null},o.createElement(h,{...e}))}}},function(e){e.O(0,[880,971,117,744],function(){return e(e.s=55)}),_N_E=e.O()}]);